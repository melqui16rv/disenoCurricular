<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug AJAX Scroll - Completar Informaci√≥n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f8f9fa;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-test {
            background: #28a745;
        }
        .btn-test:hover {
            background: #218838;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f1aeb5;
            color: #721c24;
        }
        .test-list {
            list-style: none;
            padding: 0;
        }
        .test-list li {
            padding: 8px;
            margin: 5px 0;
            border-left: 3px solid #007bff;
            background: #f8f9fa;
        }
        .test-list li.success {
            border-color: #28a745;
            background: #f0fff0;
        }
        .test-list li.error {
            border-color: #dc3545;
            background: #fff0f0;
        }
        .scrollable-content {
            height: 300px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
        }
        .section-marker {
            background: #e9ecef;
            padding: 10px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
            font-weight: bold;
        }
        .mock-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .mock-table th, .mock-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .mock-table th {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <h1>üîç Debug AJAX y Scroll - Sistema Completar Informaci√≥n</h1>
    
    <div class="debug-container">
        <h2>1. Verificaci√≥n de URL y Servidor</h2>
        <p><strong>URL Correcta:</strong> <code>http://localhost:8888/app/forms/?accion=completar_informacion</code></p>
        <a href="http://localhost:8888/app/forms/?accion=completar_informacion" class="btn" target="_blank">
            üåê Abrir Vista Principal
        </a>
        <div id="status-servidor" class="status">Verificando servidor...</div>
    </div>
    
    <div class="debug-container">
        <h2>2. Pruebas de Endpoint AJAX</h2>
        <button class="btn btn-test" onclick="testEndpointAjax()">üß™ Test Endpoint AJAX</button>
        <button class="btn btn-test" onclick="testPaginacionAjax()">üìÑ Test Paginaci√≥n AJAX</button>
        <button class="btn btn-test" onclick="testRegistrosAjax()">üìä Test Cambio Registros</button>
        
        <div id="ajax-results" class="status" style="display:none;"></div>
        
        <h3>Resultados de Pruebas:</h3>
        <ul id="test-results" class="test-list">
            <li>‚è≥ Esperando pruebas...</li>
        </ul>
    </div>
    
    <div class="debug-container">
        <h2>3. Simulaci√≥n de Scroll</h2>
        <p>Esta secci√≥n simula el comportamiento del scroll cuando se actualiza una secci√≥n via AJAX:</p>
        
        <!-- Contenido que genera scroll -->
        <div class="scrollable-content">
            <div class="section-marker" id="seccion-test-disenos">üìö SECCI√ìN DISE√ëOS (Simulada)</div>
            <table class="mock-table">
                <thead>
                    <tr><th>C√≥digo</th><th>Programa</th><th>Estado</th></tr>
                </thead>
                <tbody>
                    <tr><td>DIS-001</td><td>Desarrollo Software</td><td>‚úÖ Completo</td></tr>
                    <tr><td>DIS-002</td><td>Gesti√≥n Empresarial</td><td>‚ùå Faltante</td></tr>
                </tbody>
            </table>
            
            <div class="section-marker" id="seccion-test-competencias">üéØ SECCI√ìN COMPETENCIAS (Simulada)</div>
            <table class="mock-table">
                <thead>
                    <tr><th>C√≥digo</th><th>Competencia</th><th>Horas</th></tr>
                </thead>
                <tbody>
                    <tr><td>COMP-001</td><td>An√°lisis y Desarrollo</td><td>240</td></tr>
                    <tr><td>COMP-002</td><td>Bases de Datos</td><td>180</td></tr>
                </tbody>
            </table>
            
            <div class="section-marker" id="seccion-test-raps">üìã SECCI√ìN RAPS (Simulada)</div>
            <table class="mock-table">
                <thead>
                    <tr><th>C√≥digo</th><th>RAP</th><th>Horas</th></tr>
                </thead>
                <tbody>
                    <tr><td>RAP-001</td><td>Implementar algoritmos</td><td>60</td></tr>
                    <tr><td>RAP-002</td><td>Crear interfaces</td><td>40</td></tr>
                </tbody>
            </table>
        </div>
        
        <button class="btn btn-test" onclick="testScrollToSection('seccion-test-disenos')">‚¨ÜÔ∏è Scroll a Dise√±os</button>
        <button class="btn btn-test" onclick="testScrollToSection('seccion-test-competencias')">‚û°Ô∏è Scroll a Competencias</button>
        <button class="btn btn-test" onclick="testScrollToSection('seccion-test-raps')">‚¨áÔ∏è Scroll a RAPs</button>
    </div>
    
    <div class="debug-container">
        <h2>4. Verificaci√≥n de Archivos</h2>
        <div id="file-check" class="status">Verificando archivos del sistema...</div>
        <button class="btn btn-test" onclick="checkFiles()">üîç Verificar Archivos</button>
    </div>

    <script>
        // Verificar servidor al cargar
        window.addEventListener('load', function() {
            checkServer();
            checkFiles();
        });

        function checkServer() {
            const statusDiv = document.getElementById('status-servidor');
            fetch('http://localhost:8888/app/forms/', {
                method: 'HEAD'
            })
            .then(response => {
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = '‚úÖ Servidor funcionando correctamente en puerto 8888';
                } else {
                    throw new Error('Servidor no responde correctamente');
                }
            })
            .catch(error => {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = '‚ùå Error: ' + error.message;
            });
        }

        function addTestResult(test, success, message) {
            const resultsList = document.getElementById('test-results');
            if (resultsList.children[0].textContent.includes('Esperando')) {
                resultsList.innerHTML = '';
            }
            
            const li = document.createElement('li');
            li.className = success ? 'success' : 'error';
            li.innerHTML = `${success ? '‚úÖ' : '‚ùå'} ${test}: ${message}`;
            resultsList.appendChild(li);
        }

        function testEndpointAjax() {
            const resultsDiv = document.getElementById('ajax-results');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'status';
            resultsDiv.innerHTML = '‚è≥ Probando endpoint AJAX...';

            const params = new URLSearchParams({
                'accion_ajax': 'actualizar_seccion',
                'seccion': 'disenos',
                'pagina_disenos': '1',
                'registros_disenos': '10'
            });

            fetch('http://localhost:8888/app/forms/ajax.php?' + params.toString(), {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            })
            .then(data => {
                if (data.success) {
                    resultsDiv.className = 'status success';
                    resultsDiv.innerHTML = '‚úÖ Endpoint AJAX funcionando correctamente';
                    addTestResult('Endpoint AJAX', true, 'Respuesta JSON v√°lida recibida');
                } else {
                    throw new Error(data.message || 'Respuesta inv√°lida');
                }
            })
            .catch(error => {
                resultsDiv.className = 'status error';
                resultsDiv.innerHTML = '‚ùå Error en endpoint AJAX: ' + error.message;
                addTestResult('Endpoint AJAX', false, error.message);
            });
        }

        function testPaginacionAjax() {
            addTestResult('Test Paginaci√≥n', false, 'Iniciando...');
            
            const params = new URLSearchParams({
                'accion_ajax': 'actualizar_seccion',
                'seccion': 'competencias',
                'pagina_competencias': '2',
                'registros_competencias': '10'
            });

            fetch('http://localhost:8888/app/forms/ajax.php?' + params.toString(), {
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.pagina_actual == 2) {
                    addTestResult('Test Paginaci√≥n', true, 'Paginaci√≥n p√°gina 2 funciona correctamente');
                } else {
                    addTestResult('Test Paginaci√≥n', false, 'P√°gina incorrecta en respuesta');
                }
            })
            .catch(error => {
                addTestResult('Test Paginaci√≥n', false, error.message);
            });
        }

        function testRegistrosAjax() {
            addTestResult('Test Registros', false, 'Iniciando...');
            
            const params = new URLSearchParams({
                'accion_ajax': 'actualizar_seccion',
                'seccion': 'raps',
                'pagina_raps': '1',
                'registros_raps': '25'
            });

            fetch('http://localhost:8888/app/forms/ajax.php?' + params.toString(), {
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.registros_por_pagina == 25) {
                    addTestResult('Test Registros', true, 'Cambio a 25 registros por p√°gina funciona');
                } else {
                    addTestResult('Test Registros', false, 'Registros por p√°gina incorrectos');
                }
            })
            .catch(error => {
                addTestResult('Test Registros', false, error.message);
            });
        }

        function testScrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                // Simular el comportamiento del scroll AJAX
                section.style.transition = 'background-color 0.5s ease';
                section.style.backgroundColor = '#fff3cd';
                
                section.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                
                setTimeout(() => {
                    section.style.backgroundColor = '';
                    addTestResult('Scroll Test', true, `Scroll a ${sectionId.replace('seccion-test-', '')} completado`);
                }, 1000);
            }
        }

        function checkFiles() {
            const fileCheckDiv = document.getElementById('file-check');
            const files = [
                '/app/forms/ajax.php',
                '/app/forms/vistas/completar_informacion_new.php',
                '/app/forms/vistas/completar_informacion_funciones.php',
                '/assets/js/forms/completar-informacion.js'
            ];

            let checkResults = [];
            let checkedFiles = 0;

            files.forEach(file => {
                fetch('http://localhost:8888' + file, { method: 'HEAD' })
                .then(response => {
                    checkResults.push(`‚úÖ ${file} - OK`);
                })
                .catch(error => {
                    checkResults.push(`‚ùå ${file} - Error`);
                })
                .finally(() => {
                    checkedFiles++;
                    if (checkedFiles === files.length) {
                        fileCheckDiv.className = 'status success';
                        fileCheckDiv.innerHTML = checkResults.join('<br>');
                    }
                });
            });
        }
    </script>
</body>
</html>
